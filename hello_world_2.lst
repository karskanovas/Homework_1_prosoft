     1                                  global _start
     2                                  
     3                                  section .data
     4 00000000 6F75747075742E7478-         filename db "output.txt", 0        ; имя файла 
     4 00000009 7400               
     5 0000000B 48656C6C6F2C20776F-         message  db "Hello, world", 10     
     5 00000014 726C640A           
     6                                      length   equ $ - message           
     7 00000018 4572726F720A                err_msg  db "Error", 10
     8                                      err_len  equ $ - err_msg
     9                                  section .text
    10                                  _start:
    11                                       
    12 00000000 B802000000                  mov rax, 2               ; номер системного вызова open(filename, O_WRONLY | O_CREAT | O_TRUNC, 0644)
    13 00000005 48BF-                       mov rdi, filename        ; указатель на имя файла
    13 00000007 [0000000000000000] 
    14 0000000F BE41020000                  mov rsi, 577             ; флаги  = O_WRONLY|O_CREAT|O_TRUNC
    15 00000014 BAA4010000                  mov rdx, 0o644           ; права 
    16 00000019 0F05                        syscall
    17 0000001B 4883F800                    cmp rax, 0               ; проверка
    18 0000001F 7C3F                        jl .error_exit           ; если ошибка, переход на обработку
    19 00000021 4889C3                      mov rbx, rax             ; чтобы не потерять значение 
    20                                  
    21 00000024 B801000000                  mov rax, 1               ; записываем в файл
    22 00000029 4889DF                      mov rdi, rbx             
    23 0000002C 48BE-                       mov rsi, message         
    23 0000002E [0B00000000000000] 
    24 00000036 BA0D000000                  mov rdx, length  
    25 0000003B 4889D1                      mov rcx, rdx             ; возможно вызов syscall перезаписывает регистр rdx, поэтому для проверки нужно сохранить ожидаемую длину        
    26 0000003E 0F05                        syscall
    27 00000040 4883F800                    cmp rax, 0                    ; 1. Проверяем на отрицательное значение
    28 00000044 7C41                        jl .error_exit_clouse                                      
    29                                      ;cmp rax, rcx                  ; 2. совпадает ли rax с rdx
    30                                      ;jne .error_exit_clouse
    31                                  
    32 00000046 B803000000                  mov rax, 3                    ; закрывает
    33 0000004B 4889DF                      mov rdi, rbx
    34 0000004E 0F05                        syscall
    35 00000050 4883F800                    cmp rax, 0                    ; Проверяем, вернул ли close ошибку
    36 00000054 7C0A                        jl .error_exit
    37                                  
    38 00000056 B83C000000                  mov rax, 60              ; успешный выход
    39 0000005B 4831FF                      xor rdi, rdi             ; код возврата = 0
    40 0000005E 0F05                        syscall
    41                                  
    42                                  .error_exit:
    43 00000060 B801000000                  mov rax, 1                    
    44 00000065 BF02000000                  mov rdi, 2                    
    45 0000006A 48BE-                       mov rsi, err_msg              
    45 0000006C [1800000000000000] 
    46 00000074 BA06000000                  mov rdx, err_len              
    47 00000079 0F05                        syscall                       
    48                                  
    49 0000007B B83C000000                  mov rax, 60                   
    50 00000080 BF01000000                  mov rdi, 1                    ; rdi = 1 (ошибка)
    51 00000085 0F05                        syscall 
    52                                  
    53                                  .error_exit_clouse:      ;если файл открыт при возникновении ошибки
    54 00000087 B803000000                  mov rax, 3                    
    55 0000008C 4889DF                      mov rdi, rbx  
    56 0000008F 0F05                        syscall                                      
    57 00000091 EBCD                        jmp .error_exit
